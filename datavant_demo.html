<!doctype html>
<html>
  <head>
    <title>Garbled Circuit JS 2PC</title>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="dist/sodium.js"></script>
    <script src="dist/jigg.js"></script>
  </head>
  <body style="font-family: sans-serif; margin: 2em;">
    <h1 style="margin-bottom: 0.25em;">LIZARD WIZARD TOKENIZATION DEMO</h1>
    </select>Hexidecimal Input: <input id="input" onkeyup="countbits()" autocomplete="off" style="margin-top: 1em; margin-bottom: 0.5em; font-family: monospace; width: 40em;" value="00000000000000000000000000000000">
    <button id="button" onclick="start()">Compute</button>
    <br>
    <div id="progress" style="font-family: sans-serif; margin-top: 0.25em;"></div>
    <div id="sha256_result" style="font-family: sans-serif; margin-top: 0.25em;"></div>
  </body>
  <script type="text/javascript">
    const countbits = function () {
      if ($('#results').text().substr(0, 8) === 'Entered ') {
        $('#results').text('Entered ' + (
          (($('#base').val() === 'hex')? 4 : 1) * $('#input').val().length
        ) + ' bits');
      }
    };
    const progress = function (start, total) {
      $('#progress').text('\n\n' + start + '/' + total);
    };
    const present_sha256_results = function (sha256_result) {
      console.log("SHA256: ", sha256_result);
      console.log("SHA256 hex: ", jigg.bin2hex(sha256_result));
      $('#sha256_result').text('SHA256: ' + jigg.bin2hex(sha256_result));

    };
    const start = function () {
      // setup bits 256-511 (0-indexed) for SHA256
      // note: in SHA256 padding, the last 64 bits are used to indicate number of bits in input data to be hashed
      const inputPart1 = new Array(248).fill(0);
      const inputPart2 = [1, 1, 1, 1, 0, 0, 0, 0];
      const input = inputPart1.concat(inputPart2);

      // run evaluator for sha256
      const SHA256_circuitURL = 'circuits/sha256.txt';
      var evaluator = new jigg.Evaluator(SHA256_circuitURL, input, present_sha256_results, progress, 5000);
      evaluator.start();

      // run garbler for sha256
      $.ajax({
        url: "/garbler_sha256",
        type: "POST"
      });
    };
  </script>
</html>
